<!DOCTYPE html>
<html lang="pt-BR">

<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link rel="stylesheet" href="estilo.css">
<link rel="stylesheet" href="normalize.css">
<link rel="stylesheet" href="css/bootstrap.min.css">
<title>Pizza Tower - Web Edition</title>
<style>
body {
font-family: 'PzzTwr';
background-color: #54260d;
display: flex;
flex-direction: column;
align-items: center;
margin: 0;
padding: 20px;
}
#main-container {
position: relative;
width: 900px;
height: 500px;
box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
border-radius: 10px;
border: 5px solid black;
overflow: hidden;
}
#start-screen {
position: absolute;
top: 0;
left: 0;
width: 100%;
height: 100%;
background-image: url(imagens_jogo/Title_screen.png);
background-size: cover;
background-position: center;
display: flex;
flex-direction: column;
justify-content: flex-start;
align-items: center;
z-index: 20;
color: white;
}
#start-screen button {
margin-top: 300px;
padding: 15px 30px;
font-size: 2em;
font-weight: bold;
cursor: pointer;
background-color: orange;
border: 3px solid red;
border-radius: 10px;
box-shadow: 0 5px yellow;
}
#start-screen button:hover {
background-color: darkorange;
}
#credits {
position: absolute;
bottom: 10px;
right: 10px;
font-size: 0.8em;
color: black;
background-color: white;
border: 3px solid black;
}
#game-area {
width: 100%;
height: 100%;
background-color: black;
background-image: url(imagens_jogo/backwoag.png);
background-size: cover;
background-repeat: no-repeat;
position: relative;
display: none;
}

/* --- SPRITES DE PERSONAGENS--- */
#player {
width: 75px;
height: 100px;
position: absolute;
bottom: 0;
left: 50px;
background-image: url(imagens_jogo/Peppino_stopped.png);
background-size: contain;
background-repeat: no-repeat;
text-indent: -9999px;
border-radius: 5px;
z-index: 10;
transition: opacity 0.1s;
}
.facing-left {
transform: scaleX(-1);
}
.moving-sprite {
background-image: url(imagens_jogo/Peppino_walk.gif);
}
.running-sprite {
background-image: url(imagens_jogo/Peppino_run.png);
}
.jumping-sprite {
background-image: url(imagens_jogo/Peppino_jump.png);
}
.wall-slide-sprite {
background-image: url(imagens_jogo/Peppino_wall.png);
}
.peppino-hurt-sprite {
background-image: url(imagens_jogo/Peppino_hurt.png);
}
.peppino-stun-sprite {
background-image: url(imagens_jogo/Peppino_fireass.png);
}
.stomp-mode {
background-image: url(imagens_jogo/Peppino_jump.png);
}
.peppino-win-sprite {
background-image: url(imagens_jogo/Peppino_win.png);
}
.peppino-lose-sprite {
background-image: url(imagens_jogo/Peppino_lose.png);
}
.invincible {
opacity: 0.7;
animation: flicker 0.1s infinite alternate;
}
.is-stunned {
pointer-events: none;
}
.peppino-tired-sprite {
background-image: url(imagens_jogo/Peppino_milk.gif);
}
#the-noise {
width: 75px;
height: 100px;
position: absolute;
bottom: 0;
left: 700px;
background-image: url(imagens_jogo/Noise_walk.gif);
background-size: contain;
background-repeat: no-repeat;
text-indent: -9999px;
border-radius: 5px;
z-index: 9;
transition: opacity 0.1s;
}
.noise-idle-sprite {
background-image: url(imagens_jogo/Noise_stopped.png);
}
.noise-jumping {
background-image: url(imagens_jogo/Noise_jump.png);
}
.noise-double-jump {
background-image: url(imagens_jogo/Noise_doublejump.png);
}
.noise-win-sprite {
background-image: url(imagens_jogo/Noise_win.png);
}
.noise-disabled {
opacity: 0.7;
transform: translateY(10px);
background-image: url(imagens_jogo/Noise_hurt.png);
}
.noise-happy {
background-image: url(imagens_jogo/Noise_Happy.png);
}
.noise-scared {
background-image: url(imagens_jogo/Noise_Scary.png);
}
.noise-powered-up {
background-image: url(imagens_jogo/Pepper_Pizza_Noise.gif);
}
.noise-tired-sprite {
background-image: url(imagens_jogo/Noise_milk.gif)
}
.power-up {
width: 35px;
height: 35px;
position: absolute;
background-size: contain;
background-repeat: no-repeat;
animation: glow 1s infinite alternate;
z-index: 12;
}
.invincibility-powerup {
background-image: url(imagens_jogo/Pepper_Pizza.webp);
}
@keyframes flicker {
from {
opacity: 1;
}
to {
opacity: 0.7;
}
}
@keyframes glow {
from {
box-shadow: 0 0 5px orange, 0 0 10px yellow;
}
to {
box-shadow: 0 0 10px orange, 0 0 20px yellow;
}
}

/* --- PLATAFORMAS E ITENS --- */
.platform {
position: absolute;
background-color: #d98918;
border: 3px solid black;
border-radius: 5px;
}
.topping {
width: 25px;
height: 25px;
position: absolute;
background-size: contain;
background-repeat: no-repeat;
text-indent: -9999px;
border-radius: 50%;
animation: bounce 0.5s infinite alternate;
z-index: 8;
}

/* Sprites de Toppings Normais */
.topping-1 {
background-image: url(imagens_jogo/Mushroom.webp);
}
.topping-2 {
background-image: url(imagens_jogo/Cheese.webp);
}
.topping-3 {
background-image: url(imagens_jogo/Tomato.webp);
}
.topping-4 {
background-image: url(imagens_jogo/Weiner.webp);
}
.topping-5 {
background-image: url(imagens_jogo/Pineapple.webp);
}
.topping-gerome {
background-image: url(imagens_jogo/Gerome.webp);
}
.topping-life {
background-image: url(imagens_jogo/Peppino_hat.png);
border-radius: 5px;
}
@keyframes bounce {
from {
transform: translateY(0px);
}
to {
transform: translateY(-5px);
}
}

/* --- UI E RANKS --- */
#ui-bar {
width: 900px;
margin-bottom: 15px;
display: none;
justify-content: space-between;
font-size: 1.5em;
font-weight: bold;
color: yellow;
}
#score,
#timer,
#health {
background-color: #54260d;
padding: 5px 15px;
border: 2px solid black;
color: white;
border-radius: 5px;
display: flex;
flex-direction: column;
align-items: center;
min-width: 150px;
text-align: center;
}
#health {
min-width: 250px;
justify-content: space-around;
flex-direction: row;
}
#heart-icon,
#empty-heart-icon {
width: 25px;
height: 25px;
background-size: contain;
background-repeat: no-repeat;
margin-right: 5px;
display: inline-block;
}
#heart-icon {
background-image: url(imagens_jogo/Peppino_hat.png);
}
#empty-heart-icon {
background-image: url(imagens_jogo/Peppino_hat_damaged.png);
}

/* RANKS */
.final-rank-image {
width: 350px;
height: 200px;
background-size: contain;
background-repeat: no-repeat;
background-position: center;
margin: 20px auto 0;
background-color: transparent;
}
.rank-P-image {
background-image: url(imagens_jogo/P-Rank.png);
border: 3px solid #570faf;
}
.rank-S-image {
background-image: url(imagens_jogo/S-Rank.png);
border: 3px solid #e28f01;
}
.rank-A-image {
background-image: url(imagens_jogo/A-Rank.png);
border: 3px solid #fe1800;
}
.rank-B-image {
background-image: url(imagens_jogo/B-Rank.jpg);
border: 3px solid #78a5ff;
}
.rank-C-image {
background-image: url(imagens_jogo/C-Rank.png);
border: 3px solid #00b00d;
}
.rank-D-image {
background-image: url(imagens_jogo/D-Rank.png);
border: 3px solid #464646;
}
.rank-F-image {
background-image: url(imagens_jogo/F-Rank.webp);
border: 3px solid gray;
}
.message {
margin-top: 20px;
font-size: 2em;
font-weight: bold;
min-height: 50px;
}
.message2 {
margin-top: 20px;
font-size: 2em;
font-weight: bold;
color: black;
min-height: 50px;
}
#mute-button {
position: fixed;
top: 20px;
right: 20px;
background: none;
border: none;
font-size: 2em;
cursor: pointer;
z-index: 1000;
color: white;
text-shadow: 1px 1px black;
}
#reset-button {
margin-top: 20px;
}
</style>
</head>
<body>
<div class="line"><a class="Bordalink branco Pizza_Game_Link" href="index.html">ï¾ Site Princialï¾ </a>
</div>
<button id="mute-button" onclick="toggleMute()" title="Mute/Unmute Ãudio">ðŸ”Š</button>
<h2 class="Pizza_text">Pizza Tower - Web Edition</h2>
<div style="display:none;">
<audio id="bgm-audio" loop src="soundtrack_jogo/Background_Music.mp3"></audio>
<audio id="start-bgm-audio" loop src="soundtrack_jogo/Start_Screen_Music.mp3"></audio>
<audio id="pepper-peppino-audio" loop Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 
src="soundtrack_jogo/Pepper_Pizza_Peppino_Music.mp3"></audio>
<audio id="pepper-noise-audio" loop src="soundtrack_jogo/Pepper_Pizza_Noise.mp3"></audio>
<audio id="sfx-audio" src=""></audio>
<audio id="walk-audio" loop src="soundtrack_jogo/Peppino_step.wav"></audio>
<audio id="conflict-audio" src="soundtrack_jogo/Powerup_Conflict.wav"></audio>
</div>
<div id="ui-bar">
<div id="score">Score: 0</div>
<div id="health">Hits: </div>
<div id="timer">Time: 60</div>
</div>
<div id="main-container">
<div id="start-screen" class="text-center">
<button class="depression" onclick="hideStartScreen(); startGame();">Start Game!</button>
<div id="credits">CrÃ©ditos: Lucas Oliveira de Queiroz.</div>
</div>
<div id="game-area">
<div id="player">Peppino</div>
<div id="the-noise">Noise</div>
</div>
</div>
<div id="status" class="message2"> Controls: [A/D] to move, [W] to jump and [SHIFT] to run.
</div>
<button id="reset-button" onclick="startGame()" style="margin-top: 20px; display:none;">Restart?</button>
<div id="rank-image-container" class="final-rank-image" style="display:none;"></div>
<script>

Â  Â  Â  Â  // LÃ“GICA DO JOGO
Â  Â  Â  Â  const MAIN_CONTAINER = document.getElementById('main-container');
Â  Â  Â  Â  const START_SCREEN = document.getElementById('start-screen');
Â  Â  Â  Â  const GAME_AREA = document.getElementById('game-area');
Â  Â  Â  Â  const PLAYER = document.getElementById('player');
Â  Â  Â  Â  const NOISE = document.getElementById('the-noise');
Â  Â  Â  Â  const SCORE_DISPLAY = document.getElementById('score');
Â  Â  Â  Â  const HEALTH_DISPLAY = document.getElementById('health');
Â  Â  Â  Â  const TIMER_DISPLAY = document.getElementById('timer');
Â  Â  Â  Â  const STATUS_DISPLAY = document.getElementById('status');
Â  Â  Â  Â  const RANK_IMAGE_CONTAINER = document.getElementById('rank-image-container');
Â  Â  Â  Â  const MUTE_BUTTON = document.getElementById('mute-button');
Â  Â  Â  Â  const RESET_BUTTON = document.getElementById('reset-button');

Â  Â  Â  Â  // --- ELEMENTOS DE ÃUDIO ---
Â  Â  Â  Â  const BGM_AUDIO = document.getElementById('bgm-audio');
Â  Â  Â  Â  const START_BGM_AUDIO = document.getElementById('start-bgm-audio');
Â  Â  Â  Â  const PEPPER_PEPPINO_AUDIO = document.getElementById('pepper-peppino-audio');
Â  Â  Â  Â  const PEPPER_NOISE_AUDIO = document.getElementById('pepper-noise-audio');
Â  Â  Â  Â  const WALK_AUDIO = document.getElementById('walk-audio');
Â  Â  Â  Â  const CONFLICT_AUDIO_ELEMENT = document.getElementById('conflict-audio');
Â  Â  Â  Â  const ALL_AUDIO_ELEMENTS = [BGM_AUDIO, START_BGM_AUDIO, PEPPER_PEPPINO_AUDIO, PEPPER_NOISE_AUDIO, WALK_AUDIO];
Â  Â  Â  Â  let isMuted = false;
Â  Â  Â  Â  let sfxVolume = 0.8;
Â  Â  Â  Â  let bgmVolume = 0.5;

Â  Â  Â  Â  // --- CAMINHOS DOS SONS ---
Â  Â  Â  Â  const SOUNDS = {
Â  Â  Â  Â  Â  Â  HurtPeppino: "soundtrack_jogo/Peppino_hurt.wav",
Â  Â  Â  Â  Â  Â  ScreamPeppino: "soundtrack_jogo/Peppino_scream.wav",
Â  Â  Â  Â  Â  Â  HurtNoise: "soundtrack_jogo/Noise_hurt.wav",
Â  Â  Â  Â  Â  Â  JumpPeppino: "soundtrack_jogo/Peppino_jump.wav",
Â  Â  Â  Â  Â  Â  JumpNoise: "soundtrack_jogo/Noise_jump.wav",
Â  Â  Â  Â  Â  Â  DoubleJumpNoise: "soundtrack_jogo/Double_jump.wav",
Â  Â  Â  Â  Â  Â  RunPeppino: "soundtrack_jogo/Peppino_run.wav",
Â  Â  Â  Â  Â  Â  WinPeppino: "soundtrack_jogo/Peppino_win.mp3",
Â  Â  Â  Â  Â  Â  WinNoise: "soundtrack_jogo/Noise_win.mp3",
Â  Â  Â  Â  Â  Â  PepperSpawn: "soundtrack_jogo/Pepper_spawn.wav",
Â  Â  Â  Â  Â  Â  ToppingCollect: "soundtrack_jogo/Topping_collect.wav",
Â  Â  Â  Â  Â  Â  PepperCollect: "soundtrack_jogo/Pepper_collect.wav",
Â  Â  Â  Â  Â  Â  BackgroundMusic: "soundtrack_jogo/Background_Music.mp3",
Â  Â  Â  Â  Â  Â  StartScreenMusic: "soundtrack_jogo/Start_Music.mp3",
Â  Â  Â  Â  Â  Â  PowerupConflict: "soundtrack_jogo/Parry.wav",
Â  Â  Â  Â  Â  Â  GeromeSpawn: "soundtrack_jogo/Gerome_spawn.wav",
Â  Â  Â  Â  Â  Â  GeromeCollect: "soundtrack_jogo/Gerome_collect.wav",
Â  Â  Â  Â  Â  Â  LifeCollect: "soundtrack_jogo/Hat_collect.wav",
Â  Â  Â  Â  };

Â  Â  Â  Â  // --- FUNÃ‡Ã•ES DE ÃUDIO---
Â  Â  Â  Â  function toggleMute() {
Â  Â  Â  Â  Â  Â  isMuted = !isMuted;
Â  Â  Â  Â  Â  Â  MUTE_BUTTON.textContent = isMuted ? 'ðŸ”‡' : 'ðŸ”Š';
Â  Â  Â  Â  Â  Â  ALL_AUDIO_ELEMENTS.forEach(audio => {
Â  Â  Â  Â  Â  Â  Â  Â  audio.muted = isMuted;
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  Â  Â  function playSFX(soundPath, volume = sfxVolume) {
Â  Â  Â  Â  Â  Â  if (isMuted) return;
Â  Â  Â  Â  Â  Â  const sfx = new Audio(soundPath);
Â  Â  Â  Â  Â  Â  sfx.volume = volume;
Â  Â  Â  Â  Â  Â  sfx.play().catch(e => console.log("SFX Play Error: ", e));
Â  Â  Â  Â  }
Â  Â  Â  Â  function playBGM(musicElement) {
Â  Â  Â  Â  Â  Â  [BGM_AUDIO, START_BGM_AUDIO, PEPPER_PEPPINO_AUDIO, PEPPER_NOISE_AUDIO].forEach(audio => {
Â  Â  Â  Â  Â  Â  Â  Â  if (audio !== musicElement) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  audio.pause();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  audio.currentTime = 0;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  musicElement.muted = isMuted;
Â  Â  Â  Â  Â  Â  musicElement.volume = bgmVolume;
Â  Â  Â  Â  Â  Â  musicElement.play().catch(e => console.log("BGM Play Error (Blocked by browser, user interaction needed): ", e));
Â  Â  Â  Â  }
Â  Â  Â  Â  function stopBGM() {
Â  Â  Â  Â  Â  Â  ALL_AUDIO_ELEMENTS.forEach(audio => {
Â  Â  Â  Â  Â  Â  Â  Â  audio.pause();
Â  Â  Â  Â  Â  Â  Â  Â  audio.currentTime = 0;
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- FUNÃ‡Ã•ES DE CONTROLE DE TELA ---
Â  Â  Â  Â  function hideStartScreen() {
Â  Â  Â  Â  Â  Â  START_BGM_AUDIO.pause();
Â  Â  Â  Â  Â  Â  START_SCREEN.style.display = 'none';
Â  Â  Â  Â  Â  Â  GAME_AREA.style.display = 'block';
Â  Â  Â  Â  Â  Â  RESET_BUTTON.style.display = 'block';
Â  Â  Â  Â  Â  Â  document.getElementById('ui-bar').style.display = 'flex';
Â  Â  Â  Â  Â  Â  STATUS_DISPLAY.className = 'message';
Â  Â  Â  Â  Â  Â  STATUS_DISPLAY.style.color = 'white';
Â  Â  Â  Â  }
Â  Â  Â  Â  function showStartScreen() {
Â  Â  Â  Â  Â  Â  if (!isMuted) {
Â  Â  Â  Â  Â  Â  Â  Â  playBGM(START_BGM_AUDIO);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  START_SCREEN.style.display = 'flex';
Â  Â  Â  Â  Â  Â  GAME_AREA.style.display = 'none';
Â  Â  Â  Â  Â  Â  RESET_BUTTON.style.display = 'none';
Â  Â  Â  Â  Â  Â  document.getElementById('ui-bar').style.display = 'none';
Â  Â  Â  Â  Â  Â  STATUS_DISPLAY.textContent = 'Controls: [A/D] to move, [W] to jump and [SHIFT] to run.';
Â  Â  Â  Â  Â  Â  STATUS_DISPLAY.className = 'message2';
Â  Â  Â  Â  Â  Â  STATUS_DISPLAY.style.color = 'black';
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- SPRITES E CONFIGURAÃ‡Ã•ES ---
Â  Â  Â  Â  const PLAYER_IDLE_SPRITE = "url(imagens_jogo/Peppino_stopped.png)";
Â  Â  Â  Â  const PLAYER_WALK_SPRITE = "url(imagens_jogo/Peppino_walk.gif)";
Â  Â  Â  Â  const PLAYER_RUN_SPRITE = "url(imagens_jogo/Peppino_run.png)";
Â  Â  Â  Â  const PLAYER_JUMP_SPRITE = "url(imagens_jogo/Peppino_jump.png)";
Â  Â  Â  Â  const PLAYER_WALL_SLIDE_SPRITE = "url(imagens_jogo/Peppino_wall.png)";
Â  Â  Â  Â  const PLAYER_HURT_SPRITE = "url(imagens_jogo/Peppino_hurt.png)";
Â  Â  Â  Â  const PLAYER_STUN_SPRITE = "url(imagens_jogo/Peppino_fireass.png)";
Â  Â  Â  Â  const NOISE_IDLE_SPRITE_NEW = "url(imagens_jogo/Noise_stopped.png)";
Â  Â  Â  Â  const NOISE_WALK_SPRITE = "url(imagens_jogo/Noise_walk.gif)";
Â  Â  Â  Â  const NOISE_JUMP_SPRITE = "url(imagens_jogo/Noise_jump.png)";
Â  Â  Â  Â  const NOISE_DOUBLE_JUMP_SPRITE = "url(imagens_jogo/Noise_doublejump.png)";
Â  Â  Â  Â  const NOISE_SCARED_SPRITE = "url(imagens_jogo/Noise_Scary.png)";
Â  Â  Â  Â  const NOISE_HAPPY_SPRITE = "url(imagens_jogo/Noise_Happy.png)";
Â  Â  Â  Â  const NOISE_POWERED_SPRITE = "url(imagens_jogo/Pepper_Pizza_Noise.gif)";
Â  Â  Â  Â  const STUNNED_SPRITE = "url(imagens_jogo/Noise_hurt.png)";
Â  Â  Â  Â  const PEPPER_SPRITE = "url(imagens_jogo/Pepper_Pizza_Peppino.gif)";
Â  Â  Â  Â  const PLAYER_TIRED_SPRITE = "url(imagens_jogo/Peppino_milk.gif)";
Â  Â  Â  Â  const NOISE_TIRED_SPRITE = "url(imagens_jogo/Noise_milk.gif)";
Â  Â  Â  Â  const NOISE_HIT_BY_PEPPER_SPRITE = "url(imagens_jogo/Noise_fireass.png)";
Â  Â  Â  Â  const NOISE_POWERUP_PARRY_SPRITE = "url(imagens_jogo/Noise_parry.gif)";
Â  Â  Â  Â  const NOISE_LOSE_SPRITE = "url(imagens_jogo/Noise_lose.png)";

Â  Â  Â  Â  const GAME_WIDTH = 900;
Â  Â  Â  Â  const GAME_HEIGHT = 500;
Â  Â  Â  Â  const PLAYER_WIDTH = 75;
Â  Â  Â  Â  const PLAYER_HEIGHT = 100;
Â  Â  Â  Â  const NOISE_WIDTH = 75;
Â  Â  Â  Â  const NOISE_HEIGHT = 100;
Â  Â  Â  Â  const GRAVITY = 0.5;
Â  Â  Â  Â  const JUMP_STRENGTH = 15;
Â  Â  Â  Â  const HIT_INVINCIBILITY_TIME = 1500;
Â  Â  Â  Â  const POWERUP_INVINCIBILITY_TIME = 5000;
Â  Â  Â  Â  const WALL_SLIDE_SPEED = 1.5;
Â  Â  Â  Â  const WALL_JUMP_HORIZONTAL_PUSH = 10;
Â  Â  Â  Â  const MAX_HEALTH = 6;
Â  Â  Â  Â  const POWERUP_SPAWN_CHANCE = 0.10;
Â  Â  Â  Â  const TOPPING_SPAWN_CHANCE = 1.0;
Â  Â  Â  Â  const NOISE_POWERED_SPEED = 7;
Â  Â  Â  Â  const TOPPING_SIZE = 25;
Â  Â  Â  Â  const MAX_NOISE_JUMPS = 2;
Â  Â  Â  Â  const NOISE_SPEED = 4;
Â  Â  Â  Â  const NOISE_JUMP_CHANCE = 0.05;
Â  Â  Â  Â  const NOISE_JUMP_STRENGTH = 12;
Â  Â  Â  Â  const NOISE_DOUBLE_JUMP_COOLDOWN = 100;
Â  Â  Â  Â  const NOISE_JOKE_TIME = 2500;
Â  Â  Â  Â  const NOISE_JOKE_SPRITE = "url(imagens_jogo/Noise_joke.png)";
Â  Â  Â  Â  let score = 0;
Â  Â  Â  Â  let time = 60;
Â  Â  Â  Â  let isGameOver = true;
Â  Â  Â  Â  let health = MAX_HEALTH;
Â  Â  Â  Â  let hitsTaken = 0;
Â  Â  Â  Â  let keys = {};
Â  Â  Â  Â  let isInvincible = false;
Â  Â  Â  Â  let isPowerupInvincible = false;
Â  Â  Â  Â  let noiseIsPoweredUp = false;
Â  Â  Â  Â  let playerX = 50;
Â  Â  Â  Â  let playerY = 0;
Â  Â  Â  Â  let velocityY = 0;
Â  Â  Â  Â  let isJumping = false;
Â  Â  Â  Â  let isWallSliding = false;
Â  Â  Â  Â  let isMoving = false;
Â  Â  Â  Â  let playerFacingRight = true;
Â  Â  Â  Â  let isPeppinoStunned = false;
Â  Â  Â  Â  const PEPPINO_STUN_TIME = HIT_INVINCIBILITY_TIME;
Â  Â  Â  Â  const WALK_SPEED = 5;
Â  Â  Â  Â  const RUN_SPEED = 10;
Â  Â  Â  Â  let currentSpeed = WALK_SPEED;
Â  Â  Â  Â  const NOISE_START_X = GAME_WIDTH - NOISE_WIDTH - 50;
Â  Â  Â  Â  let noiseX = NOISE_START_X;
Â  Â  Â  Â  let noiseY = 0;
Â  Â  Â  Â  let noiseVY = 0;
Â  Â  Â  Â  let noiseJumpsUsed = 0;
Â  Â  Â  Â  let noiseIsStunned = false;
Â  Â  Â  Â  let noiseIsJoking = false;
Â  Â  Â  Â  let noiseLastJumpTime = 0;
Â  Â  Â  Â  const NOISE_STUN_TIME = 3000;
Â  Â  Â  Â  let noiseDirection = -1;
Â  Â  Â  Â  let currentNoiseSpeed = NOISE_SPEED;
Â  Â  Â  Â  const TOPPING_CLASSES = ['topping-1', 'topping-2', 'topping-3', 'topping-4', 'topping-5'];
Â  Â  Â  Â  const SPECIAL_TOPPINGS = ['topping-gerome', 'topping-life'];
Â  Â  Â  Â  let hasGeromeSpawned = false;
Â  Â  Â  Â  const PLATFORM_WIDTH = 400;
Â  Â  Â  Â  const PLATFORM_WIDTH_TOP = 300;
Â  Â  Â  Â  const platformData = [
Â  Â  Â  Â  Â  Â  { x: (GAME_WIDTH / 2) - (PLATFORM_WIDTH / 2), y: 150, w: PLATFORM_WIDTH, h: 15 },
Â  Â  Â  Â  Â  Â  { x: (GAME_WIDTH / 2) - (PLATFORM_WIDTH_TOP / 2), y: 300, w: PLATFORM_WIDTH_TOP, h: 15 }
Â  Â  Â  Â  ];
Â  Â  Â  Â  let timerInterval;
Â  Â  Â  Â  let gameLoopInterval;
Â  Â  Â  Â  let spawnInterval;
Â  Â  Â  Â  let activePowerupElement = null;
Â  Â  Â  Â  let playerPowerupTimer;
Â  Â  Â  Â  let noisePowerupTimer;

Â  Â  Â  Â  // --- IMPLEMENTAÃ‡ÃƒO DAS FUNÃ‡Ã•ES DE MOVIMENTO E COLISÃƒO ---
Â  Â  Â  Â  function createPlatforms() {
Â  Â  Â  Â  Â  Â  document.querySelectorAll('.platform').forEach(p => p.remove());
Â  Â  Â  Â  Â  Â  platformData.forEach((data, index) => {
Â  Â  Â  Â  Â  Â  Â  Â  const platform = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  platform.classList.add('platform');
Â  Â  Â  Â  Â  Â  Â  Â  platform.id = `platform-${index}`;
Â  Â  Â  Â  Â  Â  Â  Â  platform.style.left = data.x + 'px';
Â  Â  Â  Â  Â  Â  Â  Â  platform.style.bottom = data.y + 'px';
Â  Â  Â  Â  Â  Â  Â  Â  platform.style.width = data.w + 'px';
Â  Â  Â  Â  Â  Â  Â  Â  platform.style.height = data.h + 'px';
Â  Â  Â  Â  Â  Â  Â  Â  GAME_AREA.appendChild(platform);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  Â  Â  function updateHealthDisplay() {
Â  Â  Â  Â  Â  Â  let html = '';
Â  Â  Â  Â  Â  Â  for (let i = 0; i < MAX_HEALTH; i++) {
Â  Â  Â  Â  Â  Â  Â  Â  if (i < health) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  html += `<span id="heart-icon"></span>`;
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  html += `<span id="empty-heart-icon"></span>`;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  HEALTH_DISPLAY.innerHTML = 'Hits: ' + html;
Â  Â  Â  Â  }
Â  Â  Â  Â  function updatePeppinoSprite() {
Â  Â  Â  Â  Â  Â  const onPlatform = checkPlatformCollision();
Â  Â  Â  Â  Â  Â  const isGrounded = playerY === 0 || onPlatform;
Â  Â  Â  Â  Â  Â  const movingHorizontally = keys['arrowright'] || keys['d'] || keys['arrowleft'] || keys['a'];
Â  Â  Â  Â  Â  Â  isMoving = movingHorizontally;
Â  Â  Â  Â  Â  Â  if (isGrounded && isMoving) {
Â  Â  Â  Â  Â  Â  Â  Â  if (WALK_AUDIO.paused && !isMuted && !isPeppinoStunned) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  WALK_AUDIO.volume = 0.3;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  WALK_AUDIO.loop = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  WALK_AUDIO.play().catch(e => console.log("Walk Audio Play Error: ", e));
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  WALK_AUDIO.pause();
Â  Â  Â  Â  Â  Â  Â  Â  WALK_AUDIO.currentTime = 0;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  PLAYER.classList.remove('moving-sprite', 'running-sprite', 'stomp-mode', 'peppino-tired-sprite', 'peppino-hurt-sprite', 'peppino-stun-sprite', 'wall-slide-sprite');
Â  Â  Â  Â  Â  Â  if (isPowerupInvincible) {
Â  Â  Â  Â  Â  Â  Â  Â  PLAYER.style.backgroundImage = PEPPER_SPRITE;
Â  Â  Â  Â  Â  Â  Â  Â  PLAYER.classList.remove('is-stunned');
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if (PLAYER.classList.contains('peppino-tired-sprite')) {
Â  Â  Â  Â  Â  Â  Â  Â  PLAYER.style.backgroundImage = PLAYER_TIRED_SPRITE;
Â  Â  Â  Â  Â  Â  Â  Â  PLAYER.classList.remove('is-stunned');
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if (isInvincible) {
Â  Â  Â  Â  Â  Â  Â  Â  if (isPeppinoStunned) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  PLAYER.style.backgroundImage = PLAYER_STUN_SPRITE;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  PLAYER.classList.add('is-stunned');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  PLAYER.style.backgroundImage = PLAYER_HURT_SPRITE;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  PLAYER.classList.add('peppino-hurt-sprite');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  PLAYER.classList.remove('is-stunned');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  PLAYER.classList.remove('is-stunned');
Â  Â  Â  Â  Â  Â  if (isWallSliding) {
Â  Â  Â  Â  Â  Â  Â  Â  PLAYER.style.backgroundImage = PLAYER_WALL_SLIDE_SPRITE;
Â  Â  Â  Â  Â  Â  Â  Â  PLAYER.classList.add('wall-slide-sprite');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  else if (playerY > 0 && !isGrounded) {
Â  Â  Â  Â  Â  Â  Â  Â  PLAYER.style.backgroundImage = PLAYER_JUMP_SPRITE;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  else if (isGrounded) {
Â  Â  Â  Â  Â  Â  Â  Â  if (isMoving) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (currentSpeed === RUN_SPEED) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  PLAYER.style.backgroundImage = PLAYER_RUN_SPRITE;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  PLAYER.classList.add('running-sprite');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  PLAYER.style.backgroundImage = PLAYER_WALK_SPRITE;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  PLAYER.classList.add('moving-sprite');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  PLAYER.style.backgroundImage = PLAYER_IDLE_SPRITE;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if (keys['arrowright'] || keys['d']) {
Â  Â  Â  Â  Â  Â  Â  Â  playerFacingRight = true;
Â  Â  Â  Â  Â  Â  } else if (keys['arrowleft'] || keys['a']) {
Â  Â  Â  Â  Â  Â  Â  Â  playerFacingRight = false;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if (playerFacingRight) {
Â  Â  Â  Â  Â  Â  Â  Â  PLAYER.classList.remove('facing-left');
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  PLAYER.classList.add('facing-left');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  function updateNoiseSprite() {
Â  Â  Â  Â  Â  Â  if (noiseIsStunned || noiseIsJoking) {
Â  Â  Â  Â  Â  Â  Â  Â  NOISE.style.backgroundImage = noiseIsJoking ? NOISE_JOKE_SPRITE : NOISE.style.backgroundImage;
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if (NOISE.classList.contains('noise-tired-sprite')) {
Â  Â  Â  Â  Â  Â  Â  Â  NOISE.style.backgroundImage = NOISE_TIRED_SPRITE;
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if (NOISE.style.backgroundImage === NOISE_POWERUP_PARRY_SPRITE) {
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  NOISE.classList.remove('noise-happy', 'noise-scared', 'noise-jumping', 'noise-double-jump', 'noise-powered-up', 'noise-idle-sprite', 'noise-tired-sprite');
Â  Â  Â  Â  Â  Â  const onPlatform = checkNoisePlatformCollision();
Â  Â  Â  Â  Â  Â  const isGrounded = noiseY === 0 || onPlatform;
Â  Â  Â  Â  Â  Â  if (isPowerupInvincible && noiseIsPoweredUp) {
Â  Â  Â  Â  Â  Â  Â  Â  NOISE.style.backgroundImage = NOISE_POWERED_SPRITE;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  else if (noiseIsPoweredUp) {
Â  Â  Â  Â  Â  Â  Â  Â  NOISE.style.backgroundImage = NOISE_POWERED_SPRITE;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  else if (isPowerupInvincible) {
Â  Â  Â  Â  Â  Â  Â  Â  NOISE.style.backgroundImage = NOISE_SCARED_SPRITE;
Â  Â  Â  Â  Â  Â  Â  Â  NOISE.classList.add('noise-scared');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  else if (activePowerupElement) {
Â  Â  Â  Â  Â  Â  Â  Â  NOISE.style.backgroundImage = NOISE_HAPPY_SPRITE;
Â  Â  Â  Â  Â  Â  Â  Â  NOISE.classList.add('noise-happy');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  else {
Â  Â  Â  Â  Â  Â  Â  Â  if (noiseJumpsUsed === 2 && noiseY > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  NOISE.style.backgroundImage = NOISE_DOUBLE_JUMP_SPRITE;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  NOISE.classList.add('noise-double-jump');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  else if (noiseY > 0 && !isGrounded) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  NOISE.style.backgroundImage = NOISE_JUMP_SPRITE;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  NOISE.classList.add('noise-jumping');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  else if (isGrounded) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const isStationary = Math.abs(noiseX + noiseDirection * currentNoiseSpeed - noiseX) < 1;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (isStationary) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  NOISE.style.backgroundImage = NOISE_IDLE_SPRITE_NEW;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  NOISE.classList.add('noise-idle-sprite');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  NOISE.style.backgroundImage = NOISE_WALK_SPRITE;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  let noiseFacingRight = noiseDirection === 1;
Â  Â  Â  Â  Â  Â  if (noiseFacingRight) {
Â  Â  Â  Â  Â  Â  Â  Â  NOISE.classList.remove('facing-left');
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  NOISE.classList.add('facing-left');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  function checkPlatformCollision() {
Â  Â  Â  Â  Â  Â  let onPlatform = false;
Â  Â  Â  Â  Â  Â  platformData.forEach(platform => {
Â  Â  Â  Â  Â  Â  Â  Â  const horizontalOverlap = playerX < platform.x + platform.w && playerX + PLAYER_WIDTH > platform.x;
Â  Â  Â  Â  Â  Â  Â  Â  if (horizontalOverlap) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const landingZone = (playerY + velocityY <= platform.y + platform.h) && (playerY >= platform.y + platform.h);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (landingZone) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  playerY = platform.y + platform.h;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  velocityY = 0;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isJumping = false;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onPlatform = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  return onPlatform;
Â  Â  Â  Â  }
Â  Â  Â  Â  function checkNoisePlatformCollision() {
Â  Â  Â  Â  Â  Â  let onPlatform = false;
Â  Â  Â  Â  Â  Â  platformData.forEach(platform => {
Â  Â  Â  Â  Â  Â  Â  Â  const horizontalOverlap = noiseX < platform.x + platform.w && noiseX + NOISE_WIDTH > platform.x;
Â  Â  Â  Â  Â  Â  Â  Â  if (horizontalOverlap) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const landingZone = noiseY + noiseVY <= platform.y + platform.h && noiseY >= platform.y + platform.h;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (landingZone) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  noiseY = platform.y + platform.h;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  noiseVY = 0;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  noiseJumpsUsed = 0;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onPlatform = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  return onPlatform;
Â  Â  Â  Â  }
Â  Â  Â  Â  function updatePlayerPosition() {
Â  Â  Â  Â  Â  Â  if (isPeppinoStunned) {
Â  Â  Â  Â  Â  Â  Â  Â  let onPlatform = checkPlatformCollision();
Â  Â  Â  Â  Â  Â  Â  Â  if (!onPlatform) { velocityY -= GRAVITY; }
Â  Â  Â  Â  Â  Â  Â  Â  playerY += velocityY;
Â  Â  Â  Â  Â  Â  Â  Â  if (playerY <= 0) { playerY = 0; velocityY = 0; isJumping = false; }
Â  Â  Â  Â  Â  Â  Â  Â  PLAYER.style.bottom = playerY + 'px';
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  let onPlatform = checkPlatformCollision();
Â  Â  Â  Â  Â  Â  let isGrounded = playerY === 0 || onPlatform;
Â  Â  Â  Â  Â  Â  const onLeftWall = playerX <= 0;
Â  Â  Â  Â  Â  Â  const onRightWall = playerX >= GAME_AREA.clientWidth - PLAYER_WIDTH;
Â  Â  Â  Â  Â  Â  if (!isGrounded && ((onLeftWall && (keys['ArrowLeft'] || keys['a'])) || (onRightWall && (keys['ArrowRight'] || keys['d'])))) {
Â  Â  Â  Â  Â  Â  Â  Â  isWallSliding = true;
Â  Â  Â  Â  Â  Â  Â  Â  if (velocityY < -WALL_SLIDE_SPEED) { velocityY = -WALL_SLIDE_SPEED; }
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  isWallSliding = false;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if (keys['arrowright'] || keys['d']) { playerX += currentSpeed; }
Â  Â  Â  Â  Â  Â  if (keys['arrowleft'] || keys['a']) { playerX -= currentSpeed; }
Â  Â  Â  Â  Â  Â  if (!isWallSliding && !onPlatform) { velocityY -= GRAVITY; }

Â  Â  Â  Â  Â  Â  playerY += velocityY;
Â  Â  Â  Â  Â  Â  if (playerY >= GAME_HEIGHT - PLAYER_HEIGHT) { playerY = GAME_HEIGHT - PLAYER_HEIGHT; if (velocityY > 0) { velocityY = 0; } }
Â  Â  Â  Â  Â  Â  if (playerY <= 0) { playerY = 0; velocityY = 0; isJumping = false; }
Â  Â  Â  Â  Â  Â  playerX = Math.max(0, Math.min(GAME_AREA.clientWidth - PLAYER_WIDTH, playerX));
Â  Â  Â  Â  Â  Â  PLAYER.style.left = playerX + 'px';
Â  Â  Â  Â  Â  Â  PLAYER.style.bottom = playerY + 'px';
Â  Â  Â  Â  }
Â  Â  Â  Â  function playerJump() {
Â  Â  Â  Â  Â  Â  if (isGameOver || isPeppinoStunned) return;
Â  Â  Â  Â  Â  Â  WALK_AUDIO.pause();
Â  Â  Â  Â  Â  Â  WALK_AUDIO.currentTime = 0;
Â  Â  Â  Â  Â  Â  if (playerY === 0 || checkPlatformCollision()) {
Â  Â  Â  Â  Â  Â  Â  Â  velocityY = JUMP_STRENGTH;
Â  Â  Â  Â  Â  Â  Â  Â  isJumping = true;
Â  Â  Â  Â  Â  Â  Â  Â  playSFX(SOUNDS.JumpPeppino);
Â  Â  Â  Â  Â  Â  } else if (isWallSliding) {
Â  Â  Â  Â  Â  Â  Â  Â  velocityY = JUMP_STRENGTH;
Â  Â  Â  Â  Â  Â  Â  Â  isJumping = true;
Â  Â  Â  Â  Â  Â  Â  Â  isWallSliding = false;
Â  Â  Â  Â  Â  Â  Â  Â  playSFX(SOUNDS.JumpPeppino);

Â  Â  Â  Â  Â  Â  Â  Â  const onLeftWall = playerX <= 0;
Â  Â  Â  Â  Â  Â  Â  Â  if (onLeftWall) { playerX += WALL_JUMP_HORIZONTAL_PUSH; } else { playerX -= WALL_JUMP_HORIZONTAL_PUSH; }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  function updateNoisePosition() {
Â  Â  Â  Â  Â  Â  if (noiseIsStunned || noiseIsJoking) { return; }
Â  Â  Â  Â  Â  Â  let onPlatform = checkNoisePlatformCollision();
Â  Â  Â  Â  Â  Â  let targetX;
Â  Â  Â  Â  Â  Â  let currentSpeed = NOISE_SPEED;
Â  Â  Â  Â  Â  Â  const isGrounded = noiseY === 0 || onPlatform;
Â  Â  Â  Â  Â  Â  const canJump = isGrounded;
Â  Â  Â  Â  Â  Â  if (isPowerupInvincible && noiseIsPoweredUp) {
Â  Â  Â  Â  Â  Â  Â  Â  targetX = noiseX + noiseDirection * NOISE_SPEED;
Â  Â  Â  Â  Â  Â  Â  Â  currentSpeed = NOISE_SPEED;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  else if (noiseIsPoweredUp) {
Â  Â  Â  Â  Â  Â  Â  Â  targetX = playerX;
Â  Â  Â  Â  Â  Â  Â  Â  currentSpeed = NOISE_POWERED_SPEED;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  else if (isPowerupInvincible) {
Â  Â  Â  Â  Â  Â  Â  Â  const distanceToPeppino = noiseX - playerX;
Â  Â  Â  Â  Â  Â  Â  Â  targetX = noiseX + (distanceToPeppino > 0 ? currentNoiseSpeed : -currentNoiseSpeed) * 10;
Â  Â  Â  Â  Â  Â  Â  Â  currentSpeed = NOISE_POWERED_SPEED * 0.8;
Â  Â  Â  Â  Â  Â  Â  Â  if (distanceToPeppino > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  noiseDirection = 1;
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  noiseDirection = -1;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  else if (activePowerupElement) {
Â  Â  Â  Â  Â  Â  Â  Â  const powerupRect = activePowerupElement.getBoundingClientRect();
Â  Â  Â  Â  Â  Â  Â  Â  const gameAreaRect = GAME_AREA.getBoundingClientRect();
Â  Â  Â  Â  Â  Â  Â  Â  const powerupXGame = powerupRect.left - gameAreaRect.left;
Â  Â  Â  Â  Â  Â  Â  Â  targetX = powerupXGame;
Â  Â  Â  Â  Â  Â  Â  Â  currentSpeed = NOISE_SPEED * 1.5;
Â  Â  Â  Â  Â  Â  Â  Â  const powerupY = parseFloat(activePowerupElement.style.bottom);
Â  Â  Â  Â  Â  Â  Â  Â  const isPowerupAboveNoise = powerupY > noiseY + NOISE_HEIGHT;
Â  Â  Â  Â  Â  Â  Â  Â  const horizontalDistance = Math.abs(noiseX - powerupXGame);
Â  Â  Â  Â  Â  Â  Â  Â  if (isPowerupAboveNoise) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (canJump && horizontalDistance < NOISE_WIDTH * 2) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  jumpNoise();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else if (!canJump && noiseJumpsUsed < MAX_NOISE_JUMPS) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  jumpNoise();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  } else if (canJump && Math.random() < NOISE_JUMP_CHANCE) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  jumpNoise();
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  else {
Â  Â  Â  Â  Â  Â  Â  Â  targetX = noiseX + noiseDirection * NOISE_SPEED;
Â  Â  Â  Â  Â  Â  Â  Â  currentSpeed = NOISE_SPEED;
Â  Â  Â  Â  Â  Â  Â  Â  if (canJump && Math.random() < NOISE_JUMP_CHANCE) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  jumpNoise();
Â  Â  Â  Â  Â  Â  Â  Â  } else if (noiseJumpsUsed === 1 && Math.random() < NOISE_JUMP_CHANCE / 2) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  jumpNoise();
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if (!isPowerupInvincible && !noiseIsPoweredUp) {
Â  Â  Â  Â  Â  Â  Â  Â  if (targetX < noiseX) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  noiseDirection = -1;
Â  Â  Â  Â  Â  Â  Â  Â  } else if (targetX > noiseX) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  noiseDirection = 1;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } else if (isPowerupInvincible && noiseIsPoweredUp) {
Â  Â  Â  Â  Â  Â  Â  Â  if (noiseX <= 0) { noiseDirection = 1; }
Â  Â  Â  Â  Â  Â  Â  Â  else if (noiseX >= GAME_AREA.clientWidth - NOISE_WIDTH) { noiseDirection = -1; }
Â  Â  Â  Â  Â  Â  } else if (noiseIsPoweredUp) {
Â  Â  Â  Â  Â  Â  Â  Â  if (noiseX < playerX) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  noiseDirection = 1;
Â  Â  Â  Â  Â  Â  Â  Â  } else if (noiseX > playerX) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  noiseDirection = -1;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } else if (isPowerupInvincible) {
Â  Â  Â  Â  Â  Â  Â  Â  if (targetX < noiseX) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  noiseDirection = -1;
Â  Â  Â  Â  Â  Â  Â  Â  } else if (targetX > noiseX) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  noiseDirection = 1;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  noiseX += noiseDirection * currentSpeed;
Â  Â  Â  Â  Â  Â  if (!noiseIsPoweredUp) {
Â  Â  Â  Â  Â  Â  Â  Â  if (noiseX <= 0 || noiseX >= GAME_AREA.clientWidth - NOISE_WIDTH) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!isPowerupInvincible && !activePowerupElement) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  noiseDirection *= -1;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  noiseX = Math.max(0, Math.min(GAME_AREA.clientWidth - NOISE_WIDTH, noiseX));
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if (noiseIsPoweredUp && isNoiseFacingTarget(targetX)) {
Â  Â  Â  Â  Â  Â  Â  Â  if (canJump || (noiseJumpsUsed === 1 && Math.random() < 0.5)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  jumpNoise();
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if (!onPlatform) { noiseVY -= GRAVITY; }
Â  Â  Â  Â  Â  Â  noiseY += noiseVY;
Â  Â  Â  Â  Â  Â  if (noiseY >= GAME_HEIGHT - NOISE_HEIGHT) { noiseY = GAME_HEIGHT - NOISE_HEIGHT; if (noiseVY > 0) { noiseVY = 0; } }
Â  Â  Â  Â  Â  Â  if (noiseY <= 0) {
Â  Â  Â  Â  Â  Â  Â  Â  noiseY = 0;
Â  Â  Â  Â  Â  Â  Â  Â  noiseVY = 0;
Â  Â  Â  Â  Â  Â  Â  Â  noiseJumpsUsed = 0;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  NOISE.style.left = noiseX + 'px';
Â  Â  Â  Â  Â  Â  NOISE.style.bottom = noiseY + 'px';
Â  Â  Â  Â  }
Â  Â  Â  Â  function isNoiseFacingTarget(targetX) {
Â  Â  Â  Â  Â  Â  if (targetX > noiseX) { return noiseDirection === 1; }
Â  Â  Â  Â  Â  Â  if (targetX < noiseX) { return noiseDirection === -1; }
Â  Â  Â  Â  Â  Â  return false;
Â  Â  Â  Â  }
Â  Â  Â  Â  function jumpNoise() {
Â  Â  Â  Â  Â  Â  const currentTime = Date.now();
Â  Â  Â  Â  Â  Â  const isGrounded = noiseY === 0 || checkNoisePlatformCollision();
Â  Â  Â  Â  Â  Â  if (isGrounded) {
Â  Â  Â  Â  Â  Â  Â  Â  noiseVY = NOISE_JUMP_STRENGTH;
Â  Â  Â  Â  Â  Â  Â  Â  noiseJumpsUsed = 1;
Â  Â  Â  Â  Â  Â  Â  Â  noiseLastJumpTime = currentTime;
Â  Â  Â  Â  Â  Â  Â  Â  playSFX(SOUNDS.JumpNoise);
Â  Â  Â  Â  Â  Â  } else if (noiseJumpsUsed === 1 && (currentTime - noiseLastJumpTime) >= NOISE_DOUBLE_JUMP_COOLDOWN) {
Â  Â  Â  Â  Â  Â  Â  Â  noiseVY = NOISE_JUMP_STRENGTH;
Â  Â  Â  Â  Â  Â  Â  Â  noiseJumpsUsed++;
Â  Â  Â  Â  Â  Â  Â  Â  playSFX(SOUNDS.DoubleJumpNoise);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  function checkCollision() {
Â  Â  Â  Â  Â  Â  const playerRect = PLAYER.getBoundingClientRect();
Â  Â  Â  Â  Â  Â  const noiseRect = NOISE.getBoundingClientRect();
Â  Â  Â  Â  Â  Â  const items = document.querySelectorAll('.topping, .power-up');
Â  Â  Â  Â  Â  Â  items.forEach(item => {
Â  Â  Â  Â  Â  Â  Â  Â  const itemRect = item.getBoundingClientRect();
Â  Â  Â  Â  Â  Â  Â  Â  if (isColliding(playerRect, itemRect)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (item.classList.contains('power-up')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  collectPowerup(item);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else if (item.classList.contains('topping-gerome')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  collectGerome(item);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else if (item.classList.contains('topping-life')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  collectLifeMushroom(item);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  collectTopping(item);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  items.forEach(item => {
Â  Â  Â  Â  Â  Â  Â  Â  const itemRect = item.getBoundingClientRect();
Â  Â  Â  Â  Â  Â  Â  Â  if (isColliding(noiseRect, itemRect) && item.classList.contains('power-up') && !noiseIsPoweredUp) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  collectNoisePowerup(item);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  if (isColliding(playerRect, noiseRect) && !noiseIsStunned && !noiseIsJoking) {
Â  Â  Â  Â  Â  Â  Â  Â  if (isPowerupInvincible && noiseIsPoweredUp) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  handleNoisePowerupConflict();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  if (isPowerupInvincible) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  handleNoisePepperHit();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  if (noiseIsPoweredUp && !isInvincible) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  handlePepperNoiseHitPeppino();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  const isStomping = (velocityY < 0) && (playerY > noiseY + NOISE_HEIGHT - 10);
Â  Â  Â  Â  Â  Â  Â  Â  if (isStomping) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  handleNoiseStomp();
Â  Â  Â  Â  Â  Â  Â  Â  } else if (!isInvincible) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  handleNoiseHit(1);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  function isColliding(rect1, rect2) {
Â  Â  Â  Â  Â  Â  return (rect1.left < rect2.right && rect1.right > rect2.left &&
Â  Â  Â  Â  Â  Â  Â  Â  rect1.bottom > rect2.top && rect1.top < rect2.bottom);
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- FUNÃ‡Ã•ES DE DANO ---
Â  Â  Â  Â  function handleNoiseHit(damage = 1) {
Â  Â  Â  Â  Â  Â  if (isInvincible) return;
Â  Â  Â  Â  Â  Â  health -= damage;
Â  Â  Â  Â  Â  Â  hitsTaken++;
Â  Â  Â  Â  Â  Â  updateHealthDisplay();

Â  Â  Â  Â  Â  Â  if (health <= 0) {
Â  Â  Â  Â  Â  Â  Â  Â  endGame();
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  playSFX(SOUNDS.HurtPeppino);
Â  Â  Â  Â  Â  Â  isInvincible = true;
Â  Â  Â  Â  Â  Â  PLAYER.classList.add('invincible', 'peppino-hurt-sprite');
Â  Â  Â  Â  Â  Â  const pushBack = 70;
Â  Â  Â  Â  Â  Â  if (playerX < noiseX) { playerX -= pushBack; } else { playerX += pushBack; }
Â  Â  Â  Â  Â  Â  playerX = Math.max(0, Math.min(GAME_AREA.clientWidth - PLAYER_WIDTH, playerX));
Â  Â  Â  Â  Â  Â  STATUS_DISPLAY.textContent = `Hit! ${health} remaining Hit(s).`;
Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  isInvincible = false;
Â  Â  Â  Â  Â  Â  Â  Â  PLAYER.classList.remove('invincible', 'peppino-hurt-sprite');
Â  Â  Â  Â  Â  Â  Â  Â  STATUS_DISPLAY.textContent = 'Get the Toppings!';
Â  Â  Â  Â  Â  Â  }, HIT_INVINCIBILITY_TIME);
Â  Â  Â  Â  }
Â  Â  Â  Â  function handlePepperNoiseHitPeppino() {
Â  Â  Â  Â  Â  Â  if (isInvincible) return;
Â  Â  Â  Â  Â  Â  health -= 2;
Â  Â  Â  Â  Â  Â  hitsTaken += 2;
Â  Â  Â  Â  Â  Â  updateHealthDisplay();

Â  Â  Â  Â  Â  Â  if (health <= 0) {
Â  Â  Â  Â  Â  Â  Â  Â  endGame();
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  playSFX(SOUNDS.ScreamPeppino);
Â  Â  Â  Â  Â  Â  isInvincible = true;
Â  Â  Â  Â  Â  Â  isPeppinoStunned = true;
Â  Â  Â  Â  Â  Â  PLAYER.classList.add('invincible', 'peppino-stun-sprite', 'is-stunned');
Â  Â  Â  Â  Â  Â  noiseIsJoking = true;
Â  Â  Â  Â  Â  Â  NOISE.style.backgroundImage = NOISE_JOKE_SPRITE;
Â  Â  Â  Â  Â  Â  NOISE.classList.add('noise-disabled');
Â  Â  Â  Â  Â  Â  const pushBack = 100;
Â  Â  Â  Â  Â  Â  if (playerX < noiseX) { playerX -= pushBack; } else { playerX += pushBack; }
Â  Â  Â  Â  Â  Â  playerX = Math.max(0, Math.min(GAME_AREA.clientWidth - PLAYER_WIDTH, playerX));
Â  Â  Â  Â  Â  Â  STATUS_DISPLAY.textContent = `Peppino is STUNNED!`;
Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  isInvincible = false;
Â  Â  Â  Â  Â  Â  Â  Â  isPeppinoStunned = false;
Â  Â  Â  Â  Â  Â  Â  Â  PLAYER.classList.remove('invincible', 'peppino-stun-sprite', 'is-stunned');
Â  Â  Â  Â  Â  Â  Â  Â  STATUS_DISPLAY.textContent = 'Get the Toppings!';
Â  Â  Â  Â  Â  Â  }, PEPPINO_STUN_TIME);
Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  noiseIsJoking = false;
Â  Â  Â  Â  Â  Â  Â  Â  NOISE.classList.remove('noise-disabled');
Â  Â  Â  Â  Â  Â  Â  Â  updateNoiseSprite();
Â  Â  Â  Â  Â  Â  }, NOISE_JOKE_TIME);
Â  Â  Â  Â  }
Â  Â  Â  Â  function dropLifeMushroom(x, y) {
Â  Â  Â  Â  Â  Â  const DROP_CHANCE = 0.20;
Â  Â  Â  Â  Â  Â  if (Math.random() < DROP_CHANCE) {
Â  Â  Â  Â  Â  Â  Â  Â  const lifeTopping = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  lifeTopping.classList.add('topping', 'topping-life');
Â  Â  Â  Â  Â  Â  Â  Â  const dropX = x + (NOISE_WIDTH / 2) - (TOPPING_SIZE / 2);
                let dropY = 0;
                platformData.forEach(platform => {
                    const horizontalOverlap = dropX < platform.x + platform.w && dropX + TOPPING_SIZE > platform.x;
                    if (horizontalOverlap && y >= platform.y + platform.h - 5) {
                        dropY = Math.max(dropY, platform.y + platform.h);
                    }
                });
                dropY = y + NOISE_HEIGHT;
Â  Â  Â  Â  Â  Â  Â  Â  lifeTopping.style.left = dropX + 'px';
Â  Â  Â  Â  Â  Â  Â  Â  lifeTopping.style.bottom = dropY + 'px';
Â  Â  Â  Â  Â  Â  Â  Â  GAME_AREA.appendChild(lifeTopping);
Â  Â  Â  Â  Â  Â  Â  Â  playSFX(SOUNDS.PepperSpawn); 
Â  Â  Â  Â  Â  Â  Â  Â  STATUS_DISPLAY.textContent = "The Noise dropped some HP!";
Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (STATUS_DISPLAY.textContent.includes("Life Mushroom")) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  STATUS_DISPLAY.textContent = 'Get the Toppings!';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }, 1500); 
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  } Â  Â  Â  Â 
Â  Â  Â  Â  function handleNoiseStomp() {
Â  Â  Â  Â  Â  Â  velocityY = JUMP_STRENGTH / 2;
Â  Â  Â  Â  Â  Â  const wasInvincible = isInvincible;
Â  Â  Â  Â  Â  Â  if (!isPowerupInvincible) {
Â  Â  Â  Â  Â  Â  Â  Â  isInvincible = true;
Â  Â  Â  Â  Â  Â  Â  Â  PLAYER.classList.remove('peppino-hurt-sprite');
Â  Â  Â  Â  Â  Â  Â  Â  PLAYER.classList.add('invincible', 'stomp-mode');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if (noiseIsPoweredUp) {
Â  Â  Â  Â  Â  Â  Â  Â  endNoisePowerup();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  noiseIsStunned = true;
Â  Â  Â  Â  Â  Â  NOISE.classList.add('noise-disabled');
Â  Â  Â  Â  Â  Â  NOISE.style.backgroundImage = STUNNED_SPRITE;
Â  Â  Â  Â  Â  Â  playSFX(SOUNDS.HurtNoise);
Â  Â  Â  Â  Â  Â  WALK_AUDIO.pause();
Â  Â  Â  Â  Â  Â  WALK_AUDIO.currentTime = 0;
Â  Â  Â  Â  Â  Â  STATUS_DISPLAY.textContent = `The Noise was stomped!`;
Â  Â  Â  Â  Â  Â  dropLifeMushroom(noiseX, noiseY); 
Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  if (!wasInvincible && !isPowerupInvincible) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isInvincible = false;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  PLAYER.classList.remove('invincible', 'stomp-mode');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  STATUS_DISPLAY.textContent = 'Get the Toppings!';
Â  Â  Â  Â  Â  Â  }, HIT_INVINCIBILITY_TIME);
Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  noiseIsStunned = false;
Â  Â  Â  Â  Â  Â  Â  Â  NOISE.classList.remove('noise-disabled');
Â  Â  Â  Â  Â  Â  Â  Â  updateNoiseSprite();
Â  Â  Â  Â  Â  Â  }, NOISE_STUN_TIME);
Â  Â  Â  Â  }
Â  Â  Â  Â  function handleNoisePepperHit() {
Â  Â  Â  Â  Â  Â  noiseIsStunned = true;
Â  Â  Â  Â  Â  Â  NOISE.classList.add('noise-disabled');
Â  Â  Â  Â  Â  Â  NOISE.style.backgroundImage = NOISE_HIT_BY_PEPPER_SPRITE;
Â  Â  Â  Â  Â  Â  const pushBack = 100;
Â  Â  Â  Â  Â  Â  if (playerX < noiseX) { noiseX += pushBack; } else { noiseX -= pushBack; }
Â  Â  Â  Â  Â  Â  noiseX = Math.max(0, Math.min(GAME_AREA.clientWidth - NOISE_WIDTH, noiseX));
Â  Â  Â  Â  Â  Â  STATUS_DISPLAY.textContent = `The Noise was KNOCKED OUT!`;
Â  Â  Â  Â  Â  Â  playSFX(SOUNDS.HurtNoise);
Â  Â  Â  Â  Â  Â  dropLifeMushroom(noiseX, noiseY); 
Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  noiseIsStunned = false;
Â  Â  Â  Â  Â  Â  Â  Â  NOISE.classList.remove('noise-disabled');
Â  Â  Â  Â  Â  Â  Â  Â  updateNoiseSprite();
Â  Â  Â  Â  Â  Â  Â  Â  STATUS_DISPLAY.textContent = 'Get the Toppings!';
Â  Â  Â  Â  Â  Â  }, NOISE_STUN_TIME * 1.5);
Â  Â  Â  Â  }
Â  Â  Â  Â  function handleNoisePowerupConflict() {
Â  Â  Â  Â  Â  Â  playSFX(SOUNDS.PowerupConflict, 1.0);
Â  Â  Â  Â  Â  Â  STATUS_DISPLAY.textContent = `Noise is not gonna SUGARCOAT IT!`;
Â  Â  Â  Â  Â  Â  NOISE.style.backgroundImage = NOISE_POWERUP_PARRY_SPRITE;
Â  Â  Â  Â  Â  Â  const pushBack = 50;
Â  Â  Â  Â  Â  Â  if (playerX < noiseX) { noiseX += pushBack; } else { noiseX -= pushBack; }
Â  Â  Â  Â  Â  Â  noiseX = Math.max(0, Math.min(GAME_AREA.clientWidth - NOISE_WIDTH, noiseX));
Â  Â  Â  Â  Â  Â  noiseIsStunned = true;
Â  Â  Â  Â  Â  Â  NOISE.classList.add('noise-disabled');
Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  noiseIsStunned = false;
Â  Â  Â  Â  Â  Â  Â  Â  NOISE.classList.remove('noise-disabled');
Â  Â  Â  Â  Â  Â  Â  Â  NOISE.style.backgroundImage = NOISE_WALK_SPRITE;
Â  Â  Â  Â  Â  Â  Â  Â  updateNoiseSprite();
Â  Â  Â  Â  Â  Â  }, 500);
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- FUNÃ‡Ã•ES DE ITENS E JOGO ---
Â  Â  Â  Â  function collectTopping(toppingElement) {
Â  Â  Â  Â  Â  Â  if (isGameOver) return;
Â  Â  Â  Â  Â  Â  score += 100;
Â  Â  Â  Â  Â  Â  SCORE_DISPLAY.textContent = `Score: ${score}`;
Â  Â  Â  Â  Â  Â  toppingElement.remove();
Â  Â  Â  Â  Â  Â  playSFX(SOUNDS.ToppingCollect);
Â  Â  Â  Â  }
Â  Â  Â  Â  function collectGerome(geromeElement) {
Â  Â  Â  Â  Â  Â  if (isGameOver) return;
Â  Â  Â  Â  Â  Â  score += 500;
Â  Â  Â  Â  Â  Â  SCORE_DISPLAY.textContent = `Score: ${score}`;
Â  Â  Â  Â  Â  Â  geromeElement.remove();
Â  Â  Â  Â  Â  Â  playSFX(SOUNDS.GeromeCollect);
Â  Â  Â  Â  Â  Â  STATUS_DISPLAY.textContent = "You found Gerome! +500 Points!";
Â  Â  Â  Â  }
Â  Â  Â  Â  function collectLifeMushroom(lifeElement) {
Â  Â  Â  Â  Â  Â  if (isGameOver) return;
Â  Â  Â  Â  Â  Â  lifeElement.remove();
Â  Â  Â  Â  Â  Â  playSFX(SOUNDS.LifeCollect);
Â  Â  Â  Â  Â  Â  if (health < MAX_HEALTH) {
Â  Â  Â  Â  Â  Â  Â  Â  health = Math.min(MAX_HEALTH, health + 1);
Â  Â  Â  Â  Â  Â  Â  Â  updateHealthDisplay();
Â  Â  Â  Â  Â  Â  Â  Â  STATUS_DISPLAY.textContent = "+1 Hit!";
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  score += 100;
Â  Â  Â  Â  Â  Â  Â  Â  SCORE_DISPLAY.textContent = `Score: ${score}`;
Â  Â  Â  Â  Â  Â  Â  Â  STATUS_DISPLAY.textContent = "Max health! +100 Bonus Points!";
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  function collectPowerup(powerupElement) {
Â  Â  Â  Â  Â  Â  if (isGameOver) return;
Â  Â  Â  Â  Â  Â  clearTimeout(playerPowerupTimer);
Â  Â  Â  Â  Â  Â  powerupElement.remove();
Â  Â  Â  Â  Â  Â  activePowerupElement = null;
Â  Â  Â  Â  Â  Â  isInvincible = true;
Â  Â  Â  Â  Â  Â  isPowerupInvincible = true;
Â  Â  Â  Â  Â  Â  isPeppinoStunned = false;
Â  Â  Â  Â  Â  Â  PLAYER.classList.remove('is-stunned');
Â  Â  Â  Â  Â  Â  PLAYER.classList.add('invincible');
Â  Â  Â  Â  Â  Â  updatePeppinoSprite();
Â  Â  Â  Â  Â  Â  playSFX(SOUNDS.PepperCollect);
Â  Â  Â  Â  Â  Â  playBGM(PEPPER_PEPPINO_AUDIO);
Â  Â  Â  Â  Â  Â  STATUS_DISPLAY.textContent = "You got the Pepper pizza! 5 seconds of POWER!";
Â  Â  Â  Â  Â  Â  playerPowerupTimer = setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  isInvincible = false;
Â  Â  Â  Â  Â  Â  Â  Â  isPowerupInvincible = false;
Â  Â  Â  Â  Â  Â  Â  Â  PLAYER.classList.remove('invincible');
Â  Â  Â  Â  Â  Â  Â  Â  PLAYER.classList.add('peppino-tired-sprite');
Â  Â  Â  Â  Â  Â  Â  Â  playBGM(BGM_AUDIO);
Â  Â  Â  Â  Â  Â  Â  Â  STATUS_DISPLAY.textContent = 'Have some milk!';
Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  PLAYER.classList.remove('peppino-tired-sprite');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updatePeppinoSprite();
Â  Â  Â  Â  Â  Â  Â  Â  }, 500);
Â  Â  Â  Â  Â  Â  }, POWERUP_INVINCIBILITY_TIME);
Â  Â  Â  Â  }
Â  Â  Â  Â  function collectNoisePowerup(powerupElement) {
Â  Â  Â  Â  Â  Â  if (isGameOver || noiseIsPoweredUp) return;
Â  Â  Â  Â  Â  Â  clearTimeout(noisePowerupTimer);
Â  Â  Â  Â  Â  Â  powerupElement.remove();
Â  Â  Â  Â  Â  Â  activePowerupElement = null;
Â  Â  Â  Â  Â  Â  noiseIsPoweredUp = true;
Â  Â  Â  Â  Â  Â  NOISE.classList.add('noise-powered-up');
Â  Â  Â  Â  Â  Â  updateNoiseSprite();
Â  Â  Â  Â  Â  Â  playSFX(SOUNDS.PepperCollect);
Â  Â  Â  Â  Â  Â  playBGM(PEPPER_NOISE_AUDIO);
Â  Â  Â  Â  Â  Â  STATUS_DISPLAY.textContent = "The Noise got the Pepper Pizza! RUN FOR YOUR LIFE!";
Â  Â  Â  Â  Â  Â  noisePowerupTimer = setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  endNoisePowerup();
Â  Â  Â  Â  Â  Â  }, POWERUP_INVINCIBILITY_TIME);
Â  Â  Â  Â  }
Â  Â  Â  Â  function endNoisePowerup() {
Â  Â  Â  Â  Â  Â  clearTimeout(noisePowerupTimer);
Â  Â  Â  Â  Â  Â  noiseIsPoweredUp = false;
Â  Â  Â  Â  Â  Â  NOISE.classList.remove('noise-powered-up');
Â  Â  Â  Â  Â  Â  noiseIsStunned = true;
Â  Â  Â  Â  Â  Â  NOISE.classList.add('noise-disabled', 'noise-tired-sprite');
Â  Â  Â  Â  Â  Â  updateNoiseSprite();
Â  Â  Â  Â  Â  Â  playBGM(BGM_AUDIO);
Â  Â  Â  Â  Â  Â  STATUS_DISPLAY.textContent = 'The Noise drinked some milk!.';
Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  NOISE.classList.remove('noise-tired-sprite');
Â  Â  Â  Â  Â  Â  Â  Â  NOISE.style.backgroundImage = STUNNED_SPRITE;
Â  Â  Â  Â  Â  Â  }, 500);
Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  noiseIsStunned = false;
Â  Â  Â  Â  Â  Â  Â  Â  NOISE.classList.remove('noise-disabled');
Â  Â  Â  Â  Â  Â  Â  Â  updateNoiseSprite();
Â  Â  Â  Â  Â  Â  }, NOISE_STUN_TIME);
Â  Â  Â  Â  }
Â  Â  Â  Â  function getRandomSpawnPosition() {
Â  Â  Â  Â  Â  Â  const spawnYPoints = [0];
Â  Â  Â  Â  Â  Â  platformData.forEach(p => {
Â  Â  Â  Â  Â  Â  Â  Â  spawnYPoints.push(p.y + p.h);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  const selectedY = spawnYPoints[Math.floor(Math.random() * spawnYPoints.length)];
Â  Â  Â  Â  Â  Â  if (selectedY === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  return {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  x: Math.random() * (GAME_WIDTH - TOPPING_SIZE),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  y: selectedY + 5
Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  let platform = platformData.find(p => p.y + p.h === selectedY);
Â  Â  Â  Â  Â  Â  Â  Â  if (platform) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const minX = platform.x;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const maxX = platform.x + platform.w - TOPPING_SIZE;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  x: minX + Math.random() * (maxX - minX),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  y: selectedY
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  return {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  x: Math.random() * (GAME_WIDTH - TOPPING_SIZE),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  y: 0
Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  function spawnTopping() {
Â  Â  Â  Â  Â  Â  if (isGameOver) return;
Â  Â  Â  Â  Â  Â  if (Math.random() < POWERUP_SPAWN_CHANCE && !activePowerupElement) {
Â  Â  Â  Â  Â  Â  Â  Â  const powerup = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  powerup.classList.add('power-up', 'invincibility-powerup');
Â  Â  Â  Â  Â  Â  Â  Â  const { x, y } = getRandomSpawnPosition();
Â  Â  Â  Â  Â  Â  Â  Â  powerup.style.left = x + 'px';
Â  Â  Â  Â  Â  Â  Â  Â  powerup.style.bottom = y + 'px';
Â  Â  Â  Â  Â  Â  Â  Â  GAME_AREA.appendChild(powerup);
Â  Â  Â  Â  Â  Â  Â  Â  activePowerupElement = powerup;
Â  Â  Â  Â  Â  Â  Â  Â  updateNoiseSprite();
Â  Â  Â  Â  Â  Â  Â  Â  playSFX(SOUNDS.PepperSpawn);
Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (powerup.parentNode === GAME_AREA) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  powerup.remove();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  activePowerupElement = null;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }, POWERUP_INVINCIBILITY_TIME);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if (document.querySelectorAll('.topping').length < 10) {
Â  Â  Â  Â  Â  Â  Â  Â  if (Math.random() < TOPPING_SPAWN_CHANCE) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const topping = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let randomToppingClass;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const chance = Math.random();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!hasGeromeSpawned && chance < 0.10) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  randomToppingClass = 'topping-gerome';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  hasGeromeSpawned = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  playSFX(SOUNDS.GeromeSpawn);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  randomToppingClass = TOPPING_CLASSES[Math.floor(Math.random() * TOPPING_CLASSES.length)];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  topping.classList.add('topping', randomToppingClass);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const { x, y } = getRandomSpawnPosition();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  topping.style.left = x + 'px';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  topping.style.bottom = y + 'px';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  GAME_AREA.appendChild(topping);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  function calculateRank(hits, finalScore) {
Â  Â  Â  Â  Â  Â  let rank = 'F-RANK';
Â  Â  Â  Â  Â  Â  let rankClass = 'rank-F-image';
Â  Â  Â  Â  Â  Â  let rankMessage = '';
Â  Â  Â  Â  Â  Â  let rankColor = 'gray';
Â  Â  Â  Â  Â  Â  if (health <= 0 || hits >= MAX_HEALTH) {
Â  Â  Â  Â  Â  Â  Â  Â  rankMessage = `Game Over. YOU SUCK!`;
Â  Â  Â  Â  Â  Â  Â  Â  return { rank: 'F-RANK', rankClass: 'rank-F-image', message: rankMessage, color: 'gray' };
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if (hits === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  rank = 'P-RANK';
Â  Â  Â  Â  Â  Â  Â  Â  rankClass = 'rank-P-image';
Â  Â  Â  Â  Â  Â  Â  Â  rankMessage = 'Perfection!';
Â  Â  Â  Â  Â  Â  Â  Â  rankColor = '#570faf';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  else if (hits <= 1 && finalScore >= 3000) {
Â  Â  Â  Â  Â  Â  Â  Â  rank = 'S-RANK';
Â  Â  Â  Â  Â  Â  Â  Â  rankClass = 'rank-S-image';
Â  Â  Â  Â  Â  Â  Â  Â  rankMessage = 'Your rank is (almost) PERFECT!';
Â  Â  Â  Â  Â  Â  Â  Â  rankColor = '#e28f01';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  else if (hits <= 2 && finalScore >= 2500) {
Â  Â  Â  Â  Â  Â  Â  Â  rank = 'A-RANK';
Â  Â  Â  Â  Â  Â  Â  Â  rankClass = 'rank-A-image';
Â  Â  Â  Â  Â  Â  Â  Â  rankMessage = 'Your rank is AMAZING!';
Â  Â  Â  Â  Â  Â  Â  Â  rankColor = '#fe1800';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  else if (hits <= 3 && finalScore >= 2000) {
Â  Â  Â  Â  Â  Â  Â  Â  rank = 'B-RANK';
Â  Â  Â  Â  Â  Â  Â  Â  rankClass = 'rank-B-image';
Â  Â  Â  Â  Â  Â  Â  Â  rankMessage = 'Your rank is OK.';
Â  Â  Â  Â  Â  Â  Â  Â  rankColor = '#78a5ff';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  else if (hits <= 4 && finalScore >= 1500) {
Â  Â  Â  Â  Â  Â  Â  Â  rank = 'C-RANK';
Â  Â  Â  Â  Â  Â  Â  Â  rankClass = 'rank-C-image';
Â  Â  Â  Â  Â  Â  Â  Â  rankMessage = 'Your rank is crappy.';
Â  Â  Â  Â  Â  Â  Â  Â  rankColor = '#00b00d';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  else if (hits <= 5 && finalScore >= 1000) {
Â  Â  Â  Â  Â  Â  Â  Â  rank = 'D-RANK';
Â  Â  Â  Â  Â  Â  Â  Â  rankClass = 'rank-D-image';
Â  Â  Â  Â  Â  Â  Â  Â  rankMessage = 'Your rank is AWFUL!';
Â  Â  Â  Â  Â  Â  Â  Â  rankColor = '#464646';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  else if (hits === 6 && finalScore <= 100) {
Â  Â  Â  Â  Â  Â  Â  Â  rankMessage = 'YOU SUCK!';
Â  Â  Â  Â  Â  Â  Â  Â  rankColor = 'gray';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  else {
Â  Â  Â  Â  Â  Â  Â  Â  rankMessage = `F-RANK. Score or Hits requirement not achived.`;
Â  Â  Â  Â  Â  Â  Â  Â  rankClass = 'rank-F-image';
Â  Â  Â  Â  Â  Â  Â  Â  rankColor = 'gray';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  return { rank, rankClass, message: rankMessage, color: rankColor };
Â  Â  Â  Â  }
Â  Â  Â  Â  function gameLoop() {
Â  Â  Â  Â  Â  Â  updatePeppinoSprite();
Â  Â  Â  Â  Â  Â  updateNoiseSprite();
Â  Â  Â  Â  Â  Â  updatePlayerPosition();
Â  Â  Â  Â  Â  Â  updateNoisePosition();
Â  Â  Â  Â  Â  Â  checkCollision();
Â  Â  Â  Â  Â  Â  score = Math.max(0, score);
Â  Â  Â  Â  }
Â  Â  Â  Â  function startTimer() {
Â  Â  Â  Â  Â  Â  timerInterval = setInterval(() => {
Â  Â  Â  Â  Â  Â  Â  Â  time--;
Â  Â  Â  Â  Â  Â  Â  Â  TIMER_DISPLAY.textContent = `Time: ${time}`;

Â  Â  Â  Â  Â  Â  Â  Â  if (time <= 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  clearInterval(timerInterval);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  endGame(true);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }, 1000);
Â  Â  Â  Â  }
Â  Â  Â  Â  function endGame(timeUp = false) {
Â  Â  Â  Â  Â  Â  isGameOver = true;
Â  Â  Â  Â  Â  Â  clearInterval(timerInterval);
Â  Â  Â  Â  Â  Â  clearInterval(gameLoopInterval);
Â  Â  Â  Â  Â  Â  clearInterval(spawnInterval);
Â  Â  Â  Â  Â  Â  clearTimeout(playerPowerupTimer);
Â  Â  Â  Â  Â  Â  clearTimeout(noisePowerupTimer);
Â  Â  Â  Â  Â  Â  document.querySelectorAll('.topping, .power-up').forEach(t => t.remove());
Â  Â  Â  Â  Â  Â  RANK_IMAGE_CONTAINER.style.display = 'none';
Â  Â  Â  Â  Â  Â  stopBGM();
Â  Â  Â  Â  Â  Â  activePowerupElement = null;
Â  Â  Â  Â  Â  Â  isPowerupInvincible = false;
Â  Â  Â  Â  Â  Â  noiseIsPoweredUp = false;
Â  Â  Â  Â  Â  Â  noiseIsStunned = false;
Â  Â  Â  Â  Â  Â  noiseIsJoking = false;
Â  Â  Â  Â  Â  Â  isPeppinoStunned = false;
Â  Â  Â  Â  Â  Â  PLAYER.classList.remove('moving-sprite', 'running-sprite', 'stomp-mode', 'invincible', 'peppino-tired-sprite', 'peppino-hurt-sprite', 'peppino-stun-sprite', 'is-stunned', 'wall-slide-sprite');
Â  Â  Â  Â  Â  Â  NOISE.classList.remove('noise-disabled', 'noise-jumping', 'noise-double-jump', 'noise-happy', 'noise-scared', 'noise-powered-up', 'noise-idle-sprite', 'noise-tired-sprite');
Â  Â  Â  Â  Â  Â  const rankData = calculateRank(hitsTaken, score);

Â  Â  Â  Â  Â  Â  // VITÃ“RIA DO NOISE Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  if (health <= 0) {
Â  Â  Â  Â  Â  Â  Â  Â  playSFX(SOUNDS.WinNoise);
Â  Â  Â  Â  Â  Â  Â  Â  STATUS_DISPLAY.textContent = rankData.message;
Â  Â  Â  Â  Â  Â  Â  Â  STATUS_DISPLAY.style.color = rankData.color;
Â  Â  Â  Â  Â  Â  Â  Â  PLAYER.style.backgroundImage = 'url(imagens_jogo/Peppino_lose.png)';
Â  Â  Â  Â  Â  Â  Â  Â  NOISE.style.backgroundImage = 'url(imagens_jogo/Noise_win.png)';
Â  Â  Â  Â  Â  Â  Â  Â  NOISE.classList.remove('facing-left');
Â  Â  Â  Â  Â  Â  Â  Â  RANK_IMAGE_CONTAINER.style.display = 'block';
Â  Â  Â  Â  Â  Â  Â  Â  RANK_IMAGE_CONTAINER.className = `final-rank-image ${rankData.rankClass}`;

Â  Â  Â  Â  Â  Â  Â  Â  // VITÃ“RIA DO PEPPINO Â  Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  } else if (timeUp) {
Â  Â  Â  Â  Â  Â  Â  Â  playSFX(SOUNDS.WinPeppino);
Â  Â  Â  Â  Â  Â  Â  Â  STATUS_DISPLAY.textContent = `Rank ${rankData.rank}! Score: ${score}. ${rankData.message}`;
Â  Â  Â  Â  Â  Â  Â  Â  STATUS_DISPLAY.style.color = rankData.color;
Â  Â  Â  Â  Â  Â  Â  Â  RANK_IMAGE_CONTAINER.style.display = 'block';
Â  Â  Â  Â  Â  Â  Â  Â  RANK_IMAGE_CONTAINER.className = `final-rank-image ${rankData.rankClass}`;
Â  Â  Â  Â  Â  Â  Â  Â  PLAYER.style.backgroundImage = 'url(imagens_jogo/Peppino_win.png)';
Â  Â  Â  Â  Â  Â  Â  Â  NOISE.style.backgroundImage = NOISE_LOSE_SPRITE;
Â  Â  Â  Â  Â  Â  Â  Â  NOISE.classList.remove('facing-left');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  STATUS_DISPLAY.style.display = 'block';
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- CONTROLES DO TECLADO ---
Â  Â  Â  Â  document.addEventListener('keydown', (e) => {
Â  Â  Â  Â  Â  Â  if (isGameOver || isPeppinoStunned) return;
Â  Â  Â  Â  Â  Â  keys[e.key.toLowerCase()] = true;
Â  Â  Â  Â  Â  Â  const key = e.key.toLowerCase();
Â  Â  Â  Â  Â  Â  if (key === ' ' || key === 'w') {
Â  Â  Â  Â  Â  Â  Â  Â  playerJump();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if (key === 'shift' && currentSpeed === WALK_SPEED) {
Â  Â  Â  Â  Â  Â  Â  Â  currentSpeed = RUN_SPEED;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  Â  Â  document.addEventListener('keyup', (e) => {
Â  Â  Â  Â  Â  Â  const key = e.key.toLowerCase();
Â  Â  Â  Â  Â  Â  keys[key] = false;
Â  Â  Â  Â  Â  Â  if (key === 'shift') {
Â  Â  Â  Â  Â  Â  Â  Â  currentSpeed = WALK_SPEED;
Â  Â  Â  Â  Â  Â  Â  Â  PLAYER.textContent = 'Peppino';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });

Â  Â  Â  Â  // --- INICIALIZAÃ‡ÃƒO ---
Â  Â  Â  Â  function startGame() {
Â  Â  Â  Â  Â  Â  if (!isGameOver) { endGame(); }
Â  Â  Â  Â  Â  Â  if (START_SCREEN.style.display !== 'none') {
Â  Â  Â  Â  Â  Â  Â  Â  hideStartScreen();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  score = 0;
Â  Â  Â  Â  Â  Â  time = 60;
Â  Â  Â  Â  Â  Â  health = MAX_HEALTH;
Â  Â  Â  Â  Â  Â  hitsTaken = 0;
Â  Â  Â  Â  Â  Â  isGameOver = false;
Â  Â  Â  Â  Â  Â  keys = {};
Â  Â  Â  Â  Â  Â  currentSpeed = WALK_SPEED;
Â  Â  Â  Â  Â  Â  isInvincible = false;
Â  Â  Â  Â  Â  Â  isPowerupInvincible = false;
Â  Â  Â  Â  Â  Â  noiseIsPoweredUp = false;
Â  Â  Â  Â  Â  Â  activePowerupElement = null;
Â  Â  Â  Â  Â  Â  isWallSliding = false;
Â  Â  Â  Â  Â  Â  noiseIsStunned = false;
Â  Â  Â  Â  Â  Â  noiseIsJoking = false;
Â  Â  Â  Â  Â  Â  isPeppinoStunned = false;
Â  Â  Â  Â  Â  Â  playerFacingRight = true;
Â  Â  Â  Â  Â  Â  hasGeromeSpawned = false;
Â  Â  Â  Â  Â  Â  clearTimeout(playerPowerupTimer);
Â  Â  Â  Â  Â  Â  clearTimeout(noisePowerupTimer);
Â  Â  Â  Â  Â  Â  velocityY = 0;
Â  Â  Â  Â  Â  Â  noiseVY = 0;
Â  Â  Â  Â  Â  Â  noiseLastJumpTime = 0;
Â  Â  Â  Â  Â  Â  PLAYER.classList.remove('invincible', 'stomp-mode', 'facing-left', 'running-sprite', 'moving-sprite', 'peppino-tired-sprite', 'peppino-hurt-sprite', 'peppino-stun-sprite', 'is-stunned', 'wall-slide-sprite');
Â  Â  Â  Â  Â  Â  PLAYER.style.backgroundImage = PLAYER_IDLE_SPRITE;
Â  Â  Â  Â  Â  Â  NOISE.classList.remove('noise-disabled', 'facing-left', 'noise-jumping', 'noise-double-jump', 'noise-happy', 'noise-scared', 'noise-powered-up', 'noise-idle-sprite', 'noise-tired-sprite');
Â  Â  Â  Â  Â  Â  NOISE.style.backgroundImage = NOISE_WALK_SPRITE;
Â  Â  Â  Â  Â  Â  RANK_IMAGE_CONTAINER.style.display = 'none';
Â  Â  Â  Â  Â  Â  clearInterval(timerInterval);
Â  Â  Â  Â  Â  Â  clearInterval(gameLoopInterval);
Â  Â  Â  Â  Â  Â  clearInterval(spawnInterval);
Â  Â  Â  Â  Â  Â  document.querySelectorAll('.topping, .power-up').forEach(t => t.remove());
Â  Â  Â  Â  Â  Â  SCORE_DISPLAY.textContent = 'Score: 0';
Â  Â  Â  Â  Â  Â  TIMER_DISPLAY.textContent = 'Time: 60';
Â  Â  Â  Â  Â  Â  updateHealthDisplay();
Â  Â  Â  Â  Â  Â  STATUS_DISPLAY.textContent = 'Use the platforms to get the Toppings!';
Â  Â  Â  Â  Â  Â  STATUS_DISPLAY.className = 'message';
Â  Â  Â  Â  Â  Â  STATUS_DISPLAY.style.color = 'white';
Â  Â  Â  Â  Â  Â  STATUS_DISPLAY.style.display = 'block';
Â  Â  Â  Â  Â  Â  playBGM(BGM_AUDIO);
Â  Â  Â  Â  Â  Â  playerX = 50;
Â  Â  Â  Â  Â  Â  playerY = 0;
Â  Â  Â  Â  Â  Â  noiseX = NOISE_START_X;
Â  Â  Â  Â  Â  Â  noiseY = 0;
Â  Â  Â  Â  Â  Â  PLAYER.style.left = playerX + 'px';
Â  Â  Â  Â  Â  Â  PLAYER.style.bottom = playerY + 'px';
Â  Â  Â  Â  Â  Â  NOISE.style.left = noiseX + 'px';
Â  Â  Â  Â  Â  Â  NOISE.style.bottom = noiseY + 'px'
Â  Â  Â  Â  Â  Â  createPlatforms();
Â  Â  Â  Â  Â  Â  startTimer();
Â  Â  Â  Â  Â  Â  gameLoopInterval = setInterval(gameLoop, 1000 / 60);
Â  Â  Â  Â  Â  Â  for (let i = 0; i < 5; i++) {
Â  Â  Â  Â  Â  Â  Â  Â  const topping = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  const randomToppingClass = TOPPING_CLASSES[Math.floor(Math.random() * TOPPING_CLASSES.length)];
Â  Â  Â  Â  Â  Â  Â  Â  topping.classList.add('topping', randomToppingClass);
Â  Â  Â  Â  Â  Â  Â  Â  const { x, y } = getRandomSpawnPosition();
Â  Â  Â  Â  Â  Â  Â  Â  topping.style.left = x + 'px';
Â  Â  Â  Â  Â  Â  Â  Â  topping.style.bottom = y + 'px';
Â  Â  Â  Â  Â  Â  Â  Â  GAME_AREA.appendChild(topping);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  spawnInterval = setInterval(spawnTopping, 1000);

Â  Â  Â  Â  }
Â  Â  Â  Â  window.onload = () => {
Â  Â  Â  Â  Â  Â  isGameOver = true;
Â  Â  Â  Â  Â  Â  updateHealthDisplay();
Â  Â  Â  Â  Â  Â  playBGM(START_BGM_AUDIO);
Â  Â  Â  Â  Â  Â  showStartScreen();
Â  Â  Â  Â  }
Â  Â  </script>

</body>

</html>